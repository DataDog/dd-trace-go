name: Main Branch and Release Tests

on:
  workflow_call: # allows to reuse this workflow
    inputs:
      ref:
        description: 'The branch to run the workflow on'
        required: true
        type: string
  push:
    branches:
      - release-v*
      - mq-working-branch-**
    tags-ignore:
      - 'contrib/**'
      - 'instrumentation/**'
      - 'internal/**'
      - 'orchestrion/**'
      - 'scripts/**'

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  unit-integration-tests:
    uses: ./.github/workflows/unit-integration-tests.yml
    permissions:
      contents: read
      id-token: write
      pull-requests: write
    with:
      go-version: "1.24" # Should be the highest supported version of Go
      ref: ${{ github.ref }}
    secrets: inherit
