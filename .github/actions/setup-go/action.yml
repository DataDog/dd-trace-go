name: 'Setup Go'
description: 'Setup Go and Development tools for running tests'
inputs:
  go-version:
    required: true
    description: Go version to setup.
  tools-bin:
    required: true
    description: Directory to installs tools to.
  tools-dir:
    required: true
    description: Directory that has the tool definitions.
runs:
  using: "composite"
  steps:
    - uses: actions/setup-go@d35c59abb061a4a6fb18e82ac0862c26744d6ab5 # v5.5.0
      with:
        go-version: ${{ inputs.go-version }}
        cache: true
        check-latest: true

    - name: Cache tools
      id: cache-tools
      uses: actions/cache@0400d5f644dc74513175e3cd8d07132dd4860809 # v4.2.4
      with:
        path: ${{ inputs.tools-bin }}
        key: ${{ runner.os }}-go-${{ inputs.go-version }}-tools-${{ inputs.tools-dir }}-${{ inputs.tools-bin}}-${{ hashFiles('**/go.mod', '**/go.sum') }}

    - name: Install development tools
      if: steps.cache-tools.outputs.cache-hit != 'true'
      shell: bash
      run: |-
        ./scripts/install_tools.sh --tools-dir ${{ inputs.tools-dir }} --bin-dir ${{ inputs.tools-bin }}
