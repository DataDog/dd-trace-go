name: 'Setup Go'
description: 'Setup Go and Development tools for running tests'
inputs:
  go-version:
    required: true
    description: Go version to setup.
  tools-bin:
    required: true
    description: Directory to installs tools to.
  tools-dir:
    required: true
    description: Directory that has the tool definitions.
runs:
  using: "composite"
  steps:
    - uses: actions/setup-go@7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5 # v6.2.0
      with:
        go-version: ${{ inputs.go-version }}
        cache: true
        check-latest: true

    - name: Cache tools
      id: cache-tools
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: ${{ inputs.tools-bin }}
        key: ${{ runner.os }}-go-${{ inputs.go-version }}-tools-${{ inputs.tools-dir }}-${{ inputs.tools-bin}}-${{ hashFiles('**/go.mod', '**/go.sum') }}

    - name: Install development tools
      if: steps.cache-tools.outputs.cache-hit != 'true'
      shell: bash
      run: |-
        ./scripts/install_tools.sh --tools-dir ${{ inputs.tools-dir }} --bin-dir ${{ inputs.tools-bin }}
